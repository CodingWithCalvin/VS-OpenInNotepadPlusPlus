name: 'Build and Deploy'
  
on:
  workflow_dispatch:
  pull_request:
    types: [opened, reopened]
  push:
    branches: 
      - master
    tags-ignore:
      - 'v[0-9]+.[0-9]+.[0-9]+.[0-9]+'
  
jobs:
  Release-Build-and-Deploy: 
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
    - uses: microsoft/setup-msbuild@v1.0.2
    
    - name: 1. Versioning x64 Release
      uses: CodingWithCalvin/GHA-VSVsixVersioner@v1
      with:
        extension-manifest-file: './src/CodingWithCalvin.OpenInNotepadPlusPlus.Vsix.x64/source.extension.vsixmanifest'
        extension-source-file: './src/CodingWithCalvin.OpenInNotepadPlusPlus.Vsix.x64/VsixConstants.cs'
    
    - name: 2. Bootstrapping NuGet Installer
      uses: nuget/setup-nuget@v1.1.1
    
    - name: 3. Restoring Packages
      run: nuget restore ./src/CodingWithCalvin.OpenInNotepadPlusPlus.sln

    - name: 4. Building x64 Project
      run: msbuild './src/CodingWithCalvin.OpenInNotepadPlusPlus.Vsix.x64/CodingWithCalvin.OpenInNotepadPlusPlus.Vsix.x64.csproj' /p:configuration='Release' /p:platform='x64'
        
    - name: 5. Publishing x64 Build Artifact
      uses: actions/upload-artifact@v3
      with:
        path: '${{ github.workspace }}\src\CodingWithCalvin.OpenInNotepadPlusPlus.Vsix.x64\bin\x64\Release\CodingWithCalvin.OpenInNotepadPlusPlus.Vsix.x64.vsix'
        name: latest-x64
